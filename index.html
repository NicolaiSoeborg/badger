<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <title>Badger, badger, badger, mushroom, mushroom!</title>
        <script type="text/javascript" src="https://code.jquery.com/jquery-3.1.0.min.js"></script>

        <!-- Intro.js: A step-by-step guide and feature introduction -->
        <script type="text/javascript" src="https://cdn.jsdelivr.net/intro.js/2.2.0/intro.min.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/intro.js/2.2.0/introjs.min.css">
        <script> // Hack: I can't get introJs().setOptions to store settings permanent !?
            var jsintro = function() {
                introJs().setOptions({"showStepNumbers": false, "skipLabel": "Exit", "showBullets": false}).start(); }
        </script>

        <style type="text/css">
            #container { width: 100%; overflow: hidden; }
            .draggable { cursor: move; }  /* Change mouse cursor */
            .menu { display: inline-block; float: left; padding: 2px; border-radius: 3px; background: rgb(90, 210, 135); }
            .badge { float: left; }
            .closeBtn { float: right; position: relative; right: 25px; top: 25px; }
            .hidden { display: none; }
            @media print { .no-print, .no-print * { display: none !important; } } /* Don't print menu */
        </style>

        <script type="text/javascript" src="lz-string/libs/lz-string.min.js"></script>
        <script type="text/javascript" src="lz-string/libs/base64-string.js"></script>
        <script type="text/javascript" src="app.js"></script>
    </head>
    <body ondragover="event.preventDefault();" ondrop="event.preventDefault(); dropHandler(event)">
        <div id="container">
            <div class="badge" data-position="bottom-right-aligned" data-intro="This is the current badge design. The innermost circle is the visible part of the badge, the outermost circle is the 'wrap around' part of the badge.">
                <div style="float: left">
                    <button class="closeBtn no-print" title="Delete badge" onclick="deleteBadge(this)">X</button>
                    <svg version="1.1" baseProfile="full" width="300" height="300" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <clipPath id="badge-cutoff">
                                <circle cx="150" cy="150" r="2.5cm" stroke="black" stroke-width="0.1mm" fill="transparent" />
                            </clipPath>
                            <clipPath id="badge-full">
                                <circle cx="150" cy="150" r="3cm" stroke="black" stroke-width="0.1mm" fill="transparent" />
                            </clipPath>
                            <path id="text-lower-path" d="M 60, 150 c 0, 120, 180, 120, 180, 0" stroke="black" fill="green" stroke-width="2" fill-opacity="0.5" />
                            <path id="text-upper-path" d="M 80, 150 c 0, -100, 140, -100, 140, 0" stroke="black" fill="green" stroke-width="2" fill-opacity="0.5" />
                        </defs>
                        <image id="fgImg" xlink:href="picture_bg.jpg" x="-50" y="-50" height="400px" width="400px" clip-path="url(#badge-cutoff)" beforeprint="fullCut()" />
                        <image id="bgImg" xlink:href="picture_bg.jpg" x="-50" y="-50" height="400px" width="400px" style="opacity: 0.2" class="draggable no-print" onmousedown="selectElement(event)" />
                        <circle cx="150" cy="150" r="3cm" stroke="black" stroke-width="0.1mm" stroke-dasharray="5,5" fill="transparent" />
                        <!-- Tekst -->
                        <g font-size="25" fill="white" text-anchor="middle">
                            <text>
                                <textPath xlink:href="#text-upper-path" startOffset="50%" id="TextTop" onclick="setEdit(this)">OPtur 2015</textPath>
                                <textPath xlink:href="#text-lower-path" startOffset="50%" id="TextBottom" onclick="setEdit(this)">C. Elektroteknologi</textPath>
                            </text>
                        </g>
                        <text x="150" y="175" font-size="60" text-anchor="middle" fill="white" id="TextMiddle" onclick="setEdit(this)">DTU</text>
                    </svg>
                </div>
            </div><!-- /badge -->
            <div class="menu no-print" data-intro="Select a textfield on the badge and use this box to change properties.">
                <input type="hidden" id="txtItem">
                <fieldset>
                    <legend>Properties</legend>
                    <label>
                        Text: <input type="text" id="txtText" onkeyup="saveBadge()">
                    </label>
                    <br>
                    <label>Font:
                        <select id="txtFont" onchange="saveBadge()">
                            <option style="font-family: 'Times New Roman'" value="Times New Roman" selected>Times New Roman</option>
                            <option style="font-family: 'Helvetica'" value="Helvetica">Helvetica</option>
                            <option style="font-family: 'Arial'" value="Arial">Arial</option>
                            <option style="font-family: 'Comic Sans MS'" value="Comic Sans MS">Comic Sans MS</option><!-- Muhahaha -->
                            <option style="font-family: 'Segoe Print'" value="Segoe Print">Segoe Print</option>
                            <option style="font-family: 'Terminal'" value="Terminal">Terminal</option>
                            <option style="font-family: 'Impact'" value="Impact">Impact</option>
                            <option style="font-family: 'Tahoma'" value="Tahoma">Tahoma</option>
                            <option style="font-family: 'Wingdings'" value="Wingdings">Wingdings</option>
                            <!-- TODO: How well does this work on Mac? Add option 'write name on own font'. -->
                        </select>
                    </label>
                    <br>
                    <label>
                        Size: <input type="number" style="width: 40px" id="txtSize" onkeyup="saveBadge()" onchange="saveBadge()" min="0" value="60"> px &nbsp;
                    </label>
                    <label>
                        Color: <input type="color" id="txtColor" value="#ffffff" onchange="saveBadge()">
                    </label>
                    <br>
                    <label id="TextLoc" class="hidden">
                        Text Location: <input id="TextLocSlider" type="range" min="-200" max="200" step="1" value="-100.0" onchange="moveText(this.value);" />
                    </label>
                    <br>

                    <hr>

                    <label>
                        Image: <input type="file" id="file" accept="image/*" onchange="changeBackground(this.files)" data-intro="Use this to select the background image." />
                    </label>
                    <br>
                    <label>
                        Image Scale: <input type="range" min="0.1" max="3.0" step="0.01" value="1.0" onchange="scaleImage(this.value);" />
                    </label>
                    <br>
                    <button type="button" onclick="outputLayout()" data-intro="Click this button to save the current layout. <b>WARNING: This feature is still quite buggy.</b> You should use CTRL+P to print, and then select 'save as PDF'.">Save</button>
                    <button type="button" onclick="inputLayout()">Load</button>
                    <button type="button" onclick="jsintro()">?</button>
                    <button type="button" onclick="saveBadge(); cloneBadge()" style="float: right" data-intro="When the design is ready, use this button to clone (copy) the current badge design. This allows you to easily change e.g. the name of a <i>rus</i> on your team.">Clone</button><br>
                    <div class="menu no-print hidden" id="outputBox">
                        <label>
                            Save this code: <input type="textbox" id="outputTextField" onclick="this.select()" placeholder="If this box is empty, something is wrong!" style="width: 100%" readonly/>
                        </label>
                        <br>
                        <small>Last updated <label id="lastSaveOutputTimer">999</label> sec ago.</small>
                    </div>
                    <div class="menu no-print hidden" id="inputBox">
                        <label>
                            Insert saved code: <input type="textbox" id="inputTextField" style="width: 100%" /><br>
                        </label>
                        <button onclick="loadSaved();">Load</button>&nbsp;<small><b>WARNING:</b> Do not load untrusted code!</small>
                    </div>
                </fieldset>
            </div>
        </div><!-- /container -->
        
        <script type="text/javascript">
          if (typeof jQuery == "undefined") alert("jQuery not loaded.");
          if (typeof introJs !== "function") alert("Intro.js not loaded.");
          if (window.navigator.userAgent.indexOf("Edge/") > -1)
              alert("IE Edge not supported! Please use Chrome instead.");
          if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent))
              alert("Safari not supported! Please use Chrome instead.");


          $(document).ready(function(){
              setEdit($("#TextMiddle")[0]); // "DTU" textbox selected as default

              if (typeof(localStorage) !== "undefined") {
                  // First time trying app? Lets run the introduction
                  if (!localStorage.hasrun) {
                    jsintro();
                    localStorage.setItem("hasrun", true);
                  }

                  // Prompt to load if a badge previous has been saved (and isn't the default badge)
                  //outputLayout(true);
                  /*if (localStorage.savedBadge && localStorage.savedBadge != $("#outputTextField").val()) {
                      if (confirm("Load previous saved badge?")) {
                          $("#outputTextField").val(localStorage.savedBadge);
                          loadSaved();
                      } //else if (confirm("Delete previous saved badge?")) {
                  }*/

                  // Closing app? Lets save the current layout
                  window.onbeforeunload = function(e) {
                      outputLayout(true); // Make sure "#outputTextField" is updated
                      localStorage.savedBadge = $("#outputTextField").val();
                  }

                  if (localStorage.savedBadge)
                      $("#inputTextField").val(localStorage.savedBadge);
              }

          });
        </script>
    </body>
</html>